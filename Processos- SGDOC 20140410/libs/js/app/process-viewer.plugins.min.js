/*
 * jQuery Templates Plugin 1.0.0pre
 * http://github.com/jquery/jquery-tmpl
 * Requires jQuery 1.4.2
 *
 * Copyright 2011, Software Freedom Conservancy, Inc.
 * Dual licensed under the MIT or GPL Version 2 licenses.
 * http://jquery.org/license
 */
(function(a){var r=a.fn.domManip,d="_tmplitem",q=/^[^<]*(<[\w\W]+>)[^>]*$|\{\{\! /,b={},f={},e,p={key:0,data:{}},i=0,c=0,l=[];function g(g,d,h,e){var c={data:e||(e===0||e===false)?e:d?d.data:{},_wrap:d?d._wrap:null,tmpl:null,parent:d||null,nodes:[],calls:u,nest:w,wrap:x,html:v,update:t};g&&a.extend(c,g,{nodes:[],parent:d});if(h){c.tmpl=h;c._ctnt=c._ctnt||c.tmpl(a,c);c.key=++i;(l.length?f:b)[i]=c}return c}a.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(f,d){a.fn[f]=function(n){var g=[],i=a(n),k,h,m,l,j=this.length===1&&this[0].parentNode;e=b||{};if(j&&j.nodeType===11&&j.childNodes.length===1&&i.length===1){i[d](this[0]);g=this}else{for(h=0,m=i.length;h<m;h++){c=h;k=(h>0?this.clone(true):this).get();a(i[h])[d](k);g=g.concat(k)}c=0;g=this.pushStack(g,f,i.selector)}l=e;e=null;a.tmpl.complete(l);return g}});a.fn.extend({tmpl:function(d,c,b){return a.tmpl(this[0],d,c,b)},tmplItem:function(){return a.tmplItem(this[0])},template:function(b){return a.template(b,this[0])},domManip:function(d,m,k){if(d[0]&&a.isArray(d[0])){var g=a.makeArray(arguments),h=d[0],j=h.length,i=0,f;while(i<j&&!(f=a.data(h[i++],"tmplItem")));if(f&&c)g[2]=function(b){a.tmpl.afterManip(this,b,k)};r.apply(this,g)}else r.apply(this,arguments);c=0;!e&&a.tmpl.complete(b);return this}});a.extend({tmpl:function(d,h,e,c){var i,k=!c;if(k){c=p;d=a.template[d]||a.template(null,d);f={}}else if(!d){d=c.tmpl;b[c.key]=c;c.nodes=[];c.wrapped&&n(c,c.wrapped);return a(j(c,null,c.tmpl(a,c)))}if(!d)return[];if(typeof h==="function")h=h.call(c||{});e&&e.wrapped&&n(e,e.wrapped);i=a.isArray(h)?a.map(h,function(a){return a?g(e,c,d,a):null}):[g(e,c,d,h)];return k?a(j(c,null,i)):i},tmplItem:function(b){var c;if(b instanceof a)b=b[0];while(b&&b.nodeType===1&&!(c=a.data(b,"tmplItem"))&&(b=b.parentNode));return c||p},template:function(c,b){if(b){if(typeof b==="string")b=o(b);else if(b instanceof a)b=b[0]||{};if(b.nodeType)b=a.data(b,"tmpl")||a.data(b,"tmpl",o(b.innerHTML));return typeof c==="string"?(a.template[c]=b):b}return c?typeof c!=="string"?a.template(null,c):a.template[c]||a.template(null,q.test(c)?c:a(c)):null},encode:function(a){return(""+a).split("<").join("&lt;").split(">").join("&gt;").split('"').join("&#34;").split("'").join("&#39;")}});a.extend(a.tmpl,{tag:{tmpl:{_default:{$2:"null"},open:"if($notnull_1){__=__.concat($item.nest($1,$2));}"},wrap:{_default:{$2:"null"},open:"$item.calls(__,$1,$2);__=[];",close:"call=$item.calls();__=call._.concat($item.wrap(call,__));"},each:{_default:{$2:"$index, $value"},open:"if($notnull_1){$.each($1a,function($2){with(this){",close:"}});}"},"if":{open:"if(($notnull_1) && $1a){",close:"}"},"else":{_default:{$1:"true"},open:"}else if(($notnull_1) && $1a){"},html:{open:"if($notnull_1){__.push($1a);}"},"=":{_default:{$1:"$data"},open:"if($notnull_1){__.push($.encode($1a));}"},"!":{open:""}},complete:function(){b={}},afterManip:function(f,b,d){var e=b.nodeType===11?a.makeArray(b.childNodes):b.nodeType===1?[b]:[];d.call(f,b);m(e);c++}});function j(e,g,f){var b,c=f?a.map(f,function(a){return typeof a==="string"?e.key?a.replace(/(<\w+)(?=[\s>])(?![^>]*_tmplitem)([^>]*)/g,"$1 "+d+'="'+e.key+'" $2'):a:j(a,e,a._ctnt)}):e;if(g)return c;c=c.join("");c.replace(/^\s*([^<\s][^<]*)?(<[\w\W]+>)([^>]*[^>\s])?\s*$/,function(f,c,e,d){b=a(e).get();m(b);if(c)b=k(c).concat(b);if(d)b=b.concat(k(d))});return b?b:k(c)}function k(c){var b=document.createElement("div");b.innerHTML=c;return a.makeArray(b.childNodes)}function o(b){return new Function("jQuery","$item","var $=jQuery,call,__=[],$data=$item.data;with($data){__.push('"+a.trim(b).replace(/([\\'])/g,"\\$1").replace(/[\r\t\n]/g," ").replace(/\$\{([^\}]*)\}/g,"{{= $1}}").replace(/\{\{(\/?)(\w+|.)(?:\(((?:[^\}]|\}(?!\}))*?)?\))?(?:\s+(.*?)?)?(\(((?:[^\}]|\}(?!\}))*?)\))?\s*\}\}/g,function(m,l,k,g,b,c,d){var j=a.tmpl.tag[k],i,e,f;if(!j)throw"Unknown template tag: "+k;i=j._default||[];if(c&&!/\w$/.test(b)){b+=c;c=""}if(b){b=h(b);d=d?","+h(d)+")":c?")":"";e=c?b.indexOf(".")>-1?b+h(c):"("+b+").call($item"+d:b;f=c?e:"(typeof("+b+")==='function'?("+b+").call($item):("+b+"))"}else f=e=i.$1||"null";g=h(g);return"');"+j[l?"close":"open"].split("$notnull_1").join(b?"typeof("+b+")!=='undefined' && ("+b+")!=null":"true").split("$1a").join(f).split("$1").join(e).split("$2").join(g||i.$2||"")+"__.push('"})+"');}return __;")}function n(c,b){c._wrap=j(c,true,a.isArray(b)?b:[q.test(b)?b:a(b).html()]).join("")}function h(a){return a?a.replace(/\\'/g,"'").replace(/\\\\/g,"\\"):null}function s(b){var a=document.createElement("div");a.appendChild(b.cloneNode(true));return a.innerHTML}function m(o){var n="_"+c,k,j,l={},e,p,h;for(e=0,p=o.length;e<p;e++){if((k=o[e]).nodeType!==1)continue;j=k.getElementsByTagName("*");for(h=j.length-1;h>=0;h--)m(j[h]);m(k)}function m(j){var p,h=j,k,e,m;if(m=j.getAttribute(d)){while(h.parentNode&&(h=h.parentNode).nodeType===1&&!(p=h.getAttribute(d)));if(p!==m){h=h.parentNode?h.nodeType===11?0:h.getAttribute(d)||0:0;if(!(e=b[m])){e=f[m];e=g(e,b[h]||f[h]);e.key=++i;b[i]=e}c&&o(m)}j.removeAttribute(d)}else if(c&&(e=a.data(j,"tmplItem"))){o(e.key);b[e.key]=e;h=a.data(j.parentNode,"tmplItem");h=h?h.key:0}if(e){k=e;while(k&&k.key!=h){k.nodes.push(j);k=k.parent}delete e._ctnt;delete e._wrap;a.data(j,"tmplItem",e)}function o(a){a=a+n;e=l[a]=l[a]||g(e,b[e.parent.key+n]||e.parent)}}}function u(a,d,c,b){if(!a)return l.pop();l.push({_:a,tmpl:d,item:this,data:c,options:b})}function w(d,c,b){return a.tmpl(a.template(d),c,b,this)}function x(b,d){var c=b.options||{};c.wrapped=d;return a.tmpl(a.template(b.tmpl),b.data,c,b.item)}function v(d,c){var b=this._wrap;return a.map(a(a.isArray(b)?b.join(""):b).filter(d||"*"),function(a){return c?a.innerText||a.textContent:a.outerHTML||s(a)})}function t(){var b=this.nodes;a.tmpl(null,null,null,this).insertBefore(b[0]);a(b).remove()}})(jQuery);
/*
 * jQuery.fullscreen library v0.3.5
 * Copyright (c) 2013 Vladimir Zhuravlev
 *
 * @license https://github.com/private-face/jquery.fullscreen/blob/master/LICENSE
 *
 * Date: Fri Jul  5 21:48:38 NOVT 2013
 **/
;(function($) {

function defined(a) {
    return typeof a !== 'undefined';
}

function extend(child, parent, prototype) {
    var F = function() {};
    F.prototype = parent.prototype;
    child.prototype = new F();
    child.prototype.constructor = child;
    parent.prototype.constructor = parent;
    child._super = parent.prototype;
    if (prototype) {
        $.extend(child.prototype, prototype);
    }
}

var SUBST = [
    ['', ''],               // spec
    ['exit', 'cancel'],     // firefox & old webkits expect cancelFullScreen instead of exitFullscreen
    ['screen', 'Screen']    // firefox expects FullScreen instead of Fullscreen
];

var VENDOR_PREFIXES = ['', 'o', 'ms', 'moz', 'webkit', 'webkitCurrent'];

function native(obj, name) {
    var prefixed;

    if (typeof obj === 'string') {
        name = obj;
        obj = document;
    }

    for (var i = 0; i < SUBST.length; ++i) {
        name = name.replace(SUBST[i][0], SUBST[i][1]);
        for (var j = 0; j < VENDOR_PREFIXES.length; ++j) {
            prefixed = VENDOR_PREFIXES[j];
            prefixed += j === 0 ? name : name.charAt(0).toUpperCase() + name.substr(1);
            if (defined(obj[prefixed])) {
                return obj[prefixed];
            }
        }
    }

    return void 0;
}var ua = navigator.userAgent;
var fsEnabled = native('fullscreenEnabled');
var IS_ANDROID_CHROME = ua.indexOf('Android') !== -1 && ua.indexOf('Chrome') !== -1; 
var IS_NATIVELY_SUPPORTED = 
        !IS_ANDROID_CHROME &&
         defined(native('fullscreenElement')) && 
        (!defined(fsEnabled) || fsEnabled === true);

var version = $.fn.jquery.split('.');
var JQ_LT_17 = (parseInt(version[0]) < 2 && parseInt(version[1]) < 7);

var FullScreenAbstract = function() {
    this.__options = null;
    this._fullScreenElement = null;
    this.__savedStyles = {};
};

FullScreenAbstract.prototype = {
    _DEFAULT_OPTIONS: {
        styles: {
            'boxSizing': 'border-box',
            'MozBoxSizing': 'border-box',
            'WebkitBoxSizing': 'border-box'
        },
        toggleClass: null
    },
    __documentOverflow: '',
    __htmlOverflow: '',
    _preventDocumentScroll: function() {
        this.__documentOverflow = $('body')[0].style.overflow;
        this.__htmlOverflow = $('html')[0].style.overflow;
        $('body, html').css('overflow', 'hidden');
    },
    _allowDocumentScroll: function() {
        $('body')[0].style.overflow = this.__documentOverflow;
        $('html')[0].style.overflow = this.__htmlOverflow;
    },
    _fullScreenChange: function() {
        if (!this.isFullScreen()) {
   
            this._allowDocumentScroll();
            //this._revertStyles.apply(this);
            $(this._fullScreenElement).attr('style', '');
            this._triggerEvents();
            this._fullScreenElement = null;
            


        } else {
            this._preventDocumentScroll();
            this._triggerEvents();
        }
    },
    _fullScreenError: function(e) {
        this._revertStyles();
        this._fullScreenElement = null;
        if (e) {
            $(document).trigger('fscreenerror', [e]);
        }
    },
    _triggerEvents: function() {
        $(this._fullScreenElement).trigger(this.isFullScreen() ? 'fscreenopen' : 'fscreenclose');
        $(document).trigger('fscreenchange', [this.isFullScreen(), this._fullScreenElement]);
    },
    _saveAndApplyStyles: function() {
        var $elem = $(this._fullScreenElement);
        this.__savedStyles = {};
        for (var property in this.__options.styles) {
            // save
            this.__savedStyles[property] = this._fullScreenElement.style[property];
            // apply
            this._fullScreenElement.style[property] = this.__options.styles[property];
        }
        if (this.__options.toggleClass) {
            $elem.addClass(this.__options.toggleClass);
        }
    },
    _revertStyles: function() {
        var $elem = $(this._fullScreenElement);
        for (var property in this.__options.styles) {
            this._fullScreenElement.style[property] = this.__savedStyles[property];
        }
        if (this.__options.toggleClass) {
            $elem.removeClass(this.__options.toggleClass);
        }
    },
    open: function(elem, options) {
        // do nothing if request is for already fullscreened element
        if (elem === this._fullScreenElement) {
            return;
        }
        // exit active fullscreen before opening another one
        if (this.isFullScreen()) {
            this.exit();
        }
        // save fullscreened element
        this._fullScreenElement = elem;
        // apply options, if any
        this.__options = $.extend(true, {}, this._DEFAULT_OPTIONS, options);
        // save current element styles and apply new
        this._saveAndApplyStyles();
    },
    exit: null,
    isFullScreen: null,
    isNativelySupported: function() {
        return IS_NATIVELY_SUPPORTED;
    }
};
var FullScreenNative = function() {
    FullScreenNative._super.constructor.apply(this, arguments);
    this.exit = $.proxy(native('exitFullscreen'), document);
    this._DEFAULT_OPTIONS = $.extend(true, {}, this._DEFAULT_OPTIONS, {
        'styles': {
            'width': '100%',
            'height': '100%'
        }
    });
    $(document)
        .bind(this._prefixedString('fullscreenchange'), $.proxy(this._fullScreenChange, this))
        .bind(this._prefixedString('fullscreenerror'), $.proxy(this._fullScreenError, this));
};

extend(FullScreenNative, FullScreenAbstract, {
    VENDOR_PREFIXES: ['', 'o', 'ms', 'moz', 'webkit'],
    _prefixedString: function(str) {
        return $.map(this.VENDOR_PREFIXES, function(s) {
            return s + str;
        }).join(' ');
    },
    open: function(elem, options) {
        FullScreenNative._super.open.apply(this, arguments);
        var requestFS = native(elem, 'requestFullscreen');
        requestFS.call(elem);
    },
    exit: $.noop,
    isFullScreen: function() {
        return native('fullscreenElement') !== null;
    },
    element: function() {
        return native('fullscreenElement');
    }
});
var FullScreenFallback = function() {
    FullScreenFallback._super.constructor.apply(this, arguments);
    this._DEFAULT_OPTIONS = $.extend({}, this._DEFAULT_OPTIONS, {
        'styles': {
            'position': 'fixed',
            'zIndex': '2147483647',
            'left': 0,
            'top': 0,
            'bottom': 0,
            'right': 0
        }
    });
    this.__delegateKeydownHandler();
};

extend(FullScreenFallback, FullScreenAbstract, {
    __isFullScreen: false,
    __delegateKeydownHandler: function() {
        var $doc = $(document);
        $doc.delegate('*', 'keydown.fullscreen', $.proxy(this.__keydownHandler, this));
        var data = JQ_LT_17 ? $doc.data('events') : $._data(document).events;
        var events = data['keydown'];
        if (!JQ_LT_17) {
            events.splice(0, 0, events.splice(events.delegateCount - 1, 1)[0]);
        } else {
            data.live.unshift(data.live.pop());
        }
    },
    __keydownHandler: function(e) {
        if (this.isFullScreen() && e.which === 27) {
            this.exit();
            return false;
        }
        return true;
    },
    _revertStyles: function() {
        FullScreenFallback._super._revertStyles.apply(this, arguments);
        // force redraw (fixes bug in IE7 with content dissapearing)
        this._fullScreenElement.offsetHeight;
    },
    open: function(elem) {
        FullScreenFallback._super.open.apply(this, arguments);
        this.__isFullScreen = true;
        this._fullScreenChange();
    },
    exit: function() {
        this.__isFullScreen = false;
        this._fullScreenChange();
    },
    isFullScreen: function() {
        return this.__isFullScreen;
    },
    element: function() {
        return this.__isFullScreen ? this._fullScreenElement : null;
    }
});$.fullscreen = IS_NATIVELY_SUPPORTED 
                ? new FullScreenNative() 
                : new FullScreenFallback();

$.fn.fullscreen = function(options) {
    var elem = this[0];

    options = $.extend({
        toggleClass: null,
        overflow: 'hidden'
    }, options);
    options.styles = {
        overflow: options.overflow
    };
    delete options.overflow;

    if (elem) {
        $.fullscreen.open(elem, options);
    }

    return this;
};
})(jQuery);

!function(a){$zoom={init:function(b,c){var d=this;$zoom.counter=0,d.layer=void 0,d.zoomImage=void 0,d.stage=void 0,d.$el=a(b),d.el=b,d.options=c,d.hotSpots=[],d.idPanel="zoom-application-container-"+$zoom.counter,d.idPanelPreview="zoom-application-container-preview-"+$zoom.counter,d.tryOuts=0,d.options.originalImage=d.options.image,d.$el.attr("role","zoom-application"),a("[data-zoomcontent]",d.$el).attr("id",d.idPanel).addClass("zoom-application-container"),d.$panelPreview=a("[data-zoompanepanel]",d.$el),d.$panelPreview.attr("id",d.idPanelPreview).addClass("zoom-application-container-preview"),d.createStage.apply(d,[]),d.detachKeydown(),d.$el.on("remove",function(){a(document).off("keydown.zoomer")}),d.options.isIE},attachKeydown:function(){var b=this;a(document).on("keydown.zoomer",function(a){var c,d;38===a.which&&b.stage.getY()<0&&(c=b.stage.getY()+b.options.moveIncrement,b.moveStageInY(c)),40===a.which&&b.stage.getY()<=0&&(c=b.stage.getY()-b.options.moveIncrement,b.moveStageInY(c)),37===a.which&&b.stage.getX()<0&&(d=b.stage.getX()+b.options.moveIncrement,b.moveStageInX(d)),39===a.which&&b.stage.getX()<=0&&(d=b.stage.getX()-b.options.moveIncrement,b.moveStageInX(d),b.refreshPreviewPanelInDrag())})},detachKeydown:function(){a(document).off("keydown.zoomer")},createStage:function(){var a=this,b=a.options.width?a.options.width:a.$el.width(),c=a.options.height?a.options.height:a.$el.height();a.stage=new Kinetic.Stage({container:a.idPanel,width:b,height:c,draggable:a.options.draggable,dragBoundFunc:function(b){var c=b,d=a.stage.getWidth()-a.zoomImage.getWidth(),e=a.stage.getHeight()-a.zoomImage.getHeight(),f=a.stage.getScale().x;return a.stage.getScale().x<1&&(d=a.stage.getWidth()-a.zoomImage.getWidth()*f,e=a.stage.getHeight()-a.zoomImage.getHeight()*f),b.x<=a.zoomImage.getWidth()*f&&a.stage.getWidth()>a.zoomImage.getWidth()*f&&(c.x=0),b.y>=a.zoomImage.getHeight()*f&&a.stage.getHeight()>a.zoomImage.getHeight()*f&&(c.y=0),b.x&&(b.x>=0?c.x=0:b.x<d&&(c.x=d)),b.y&&(b.y>=0?c.y=0:b.y<e&&(c.y=e)),a.stage.getHeight()>a.zoomImage.getHeight()*f&&(c.y=0),a.stage.getWidth()>a.zoomImage.getWidth()*f&&(c.x=0),c}}),a.layer=new Kinetic.Layer,a.verifyingImage.apply(a,[])},verifyingImage:function(){var a=this,b=a.image=document.createElement("img");b.onload=function(){if(!b.complete)return b.src=b.src,void 0;var c=b.width?b.width:"150",d=b.height?b.height:"150";a.zoomImage=new Kinetic.Image({x:0,y:0,image:b,width:c,height:d}),a.options.unavailableImage===a.options.image?a.createZoomUIFailInterface.apply(a,[]):(a.options.zoomImageOptions=a.zoomImage.getWidth()<a.stage.getWidth()||a.zoomImage.getHeight()<a.stage.getHeight()?!1:!0,a.createZoomUIInterface.apply(a,[]))},b.onerror=function(){if(a.tryOuts<1)a.options.image=a.options.unavailableImage?a.options.unavailableImage:"img/unavailable_image.png",a.tryOuts++,a.verifyingImage();else{var b="No se encontro el recurso solicitado :"+a.options.originalImage;if(!a.options.onError)throw b;a.options.onError(b)}},b.src=a.options.image},createZoomUIFailInterface:function(){var b=this;b.image.width,b.image.height;var c=a('<div class="zoom-error-image kineticjs-content"><img src="'+b.image.src+'"/><span class="zoom-message">'+b.options.originalImage+"</span></div>"),d={width:b.options.width||b.$el.width(),height:b.options.height||b.$el.height()};c.css(d),a("#"+b.idPanel).css(d).append(c)},createZoomUIInterface:function(){var b,c=this;c.$el.attr("id","zoom-application-id"),c.$kinetic=c.$el,c.$slider=a("[data-zoomslider]"),c.layer.add(c.zoomImage),c.stage.add(c.layer),c.layer.draw(),c.stage.draw(),c.stage.setDraggable(!0),c.$kinetic.removeClass("no-drag"),c.myImagePreview=a('<img src="'+c.image.src+'"/>'),c.mySquarePreview=a('<div class="zoom-pane-square"></div>'),a("#"+c.idPanelPreview).append(c.myImagePreview).append(c.mySquarePreview),c.refreshPreviewPanel(),c.stage.on("dragstart",function(){_.isEmpty(c.options.hotspots)||(c.intervalDrag=setInterval(function(){c.refreshHotspotsInDrag(),c.refreshPreviewPanelInDrag()},10)),c.$kinetic.addClass("dragging")}),c.stage.on("dragend",function(){_.isEmpty(c.options.hotspots)||(c.removeAllLocalIntervals(),c.refreshHotspotsInDrag(),c.refreshPreviewPanelInDrag()),c.$kinetic.removeClass("dragging")}),c.attachKeydown(),c.createHotSpots(),c.refreshPercentSpan();var d=c.getLimits();if(c.sliderOptions={max:100,slide:function(b,d){c.scaleStage(b,d),c.refreshPercentSpan(d.value),c.hotspotsContainer.hide(),a(".zoom-value-tooltip",c.$el).text(Math.floor(d.value))},change:function(b,d){c.refreshPercentSpan(),_.isEmpty(c.options.hotspots)||(c.refreshHotspotsScale(),c.refreshHotspotsInDrag()),c.ZoomInExpand||c.hotspotsContainer.show(),a(".zoom-value-tooltip",c.$el).text(Math.floor(d.value))},value:100},c.options.zoomImageOptions){var e=a.extend(c.sliderOptions,{min:d.min});d.min<100?(c.$slider.slider(e),a(".ui-slider-handle",c.$slider).unbind("keydown"),a(".ui-slider-handle",c.$el).append('<div class="zoom-value-tooltip">100</div>')):c.options.zoomImageOptions=!1,c.showMessage(c.options.dragMessage,!0)}c.stage.getX(),c.stage.getY(),c.scaleCounter=0,c.animationZoomIn=new Kinetic.Animation(function(){var a=c.stage.getScale().x;c.stage.getX(),c.stage.getY(),c.ZoomInExpand=!0,c.stage.setX(0),c.stage.setY(0),1-.07>=a?(c.scaleCounter=a+.07,c.stage.setScale(c.scaleCounter),c.stage.draw()):(c.ZoomInExpand=!1,c.stage.setScale(1),c.stage.draw(),_.isEmpty(c.options.hotspots)||c.refreshHotspotsScale(),c.$slider.slider("value",100*c.stage.getScale().x),c.animationZoomIn.stop()),c.refreshPreviewPanel(),c.refreshPreviewPanelInDrag()}),c.animationZoomOut=new Kinetic.Animation(function(){var a=c.stage.getScale().x,b=c.stage.getX(),d=c.stage.getY();1>=a&&b>=0&&d>=0?(c.animationZoomOut.stop(),c.stage.draw(),c.scaleCounter=0):(a>=1&&(c.scaleCounter=a-.07,c.stage.setScale(c.scaleCounter)),0>b&&c.stage.setX(0),0>d&&c.stage.setY(0),c.stage.draw()),c.refreshPreviewPanel()}),c.intervalID=0,c.$el.on("click","a.btn",function(a){a.preventDefault()}),c.$el.on("mousedown","a.btn",function(b){b.preventDefault();var d=a(this),e=d.data(),f=c.stage.getScale().x;e.hasOwnProperty("zoomin")?c.intervalID=setInterval(function(){c.scaleZoomIn()},10):e.hasOwnProperty("zoomout")?c.intervalID=setInterval(function(){c.scaleZoomOut()},10):e.hasOwnProperty("zoomexpand")&&(c.ZoomInExpand||(c.stage.setX(0),c.stage.setY(0),c.stage.draw(),c.refreshPreviewPanelInDrag()),1>f&&!c.ZoomInExpand&&c.animationZoomIn.start()),c.hotspotsContainer.hide(),c.showMessage(c.options.processMessage,!1)}),c.$el.on("mouseup","a.btn",function(){c.removeAllLocalIntervals(),c.removeMessage(),c.$slider.slider("value",100*c.stage.getScale().x),_.isEmpty(c.options.hotspots)||c.refreshHotspotsScale(),c.ZoomInExpand||c.hotspotsContainer.show()}),a("[data-zoomiconpanepanel]").click(function(b){b.preventDefault(),b.stopPropagation();var d=a(this);c.$panelPreview.is(":visible")?(d.addClass("biz-ex-icon-pane-panel-closed"),c.$panelPreview.slideUp()):(d.removeClass("biz-ex-icon-pane-panel-closed"),c.$panelPreview.slideDown())}),a(".zoom-pane-square",c.$panelPreview).draggable({containment:"parent",drag:function(){c.refreshStageFromPreviewPanel.apply(c,[])}}),c.options.onComplete&&c.options.onComplete(),b=c.stage.getScale().x,c.refreshPanel()},moveStageInY:function(a){var b,c=this;c.stage.getHeight()>c.zoomImage.getHeight()*c.stage.getScale().y||a>0?a=0:b=c.stage.getHeight()-c.zoomImage.getHeight(),b>a?c.stage.setY(b):c.stage.setY(a),c.stage.draw(),c.refreshHotspotsInDrag(),c.refreshPreviewPanelInDrag()},moveStageInX:function(a){var b,c=this;c.stage.getWidth()>c.zoomImage.getWidth()*c.stage.getScale().x||a>0?a=0:b=c.stage.getWidth()-c.zoomImage.getWidth(),b>a?c.stage.setX(b):c.stage.setX(a),c.stage.draw(),c.refreshHotspotsInDrag(),c.refreshPreviewPanelInDrag()},remove:function(){var b=this;b.stage.remove(),a(document).off("keydown.zoomer")},refreshPreviewPanel:function(){var a=this;if(a.myImagePreview){var b=a.$kinetic.width(),c=a.$kinetic.height();a.myImagePreview.width(.2*b);var d=a.image.width*a.stage.getScale().x,e=a.image.height*a.stage.getScale().y;a.myImagePreview.width();var f=a.myImagePreview.width()*b/d,g=a.$panelPreview.height()*c/e;a.mySquarePreview.width(f),a.mySquarePreview.height(g),a.refreshPreviewPanelInDrag()}},refreshStageFromPreviewPanel:function(){var a=this;a.$kinetic.width(),a.$kinetic.height();var b=a.myImagePreview.width(),c=a.myImagePreview.height(),d=a.image.width*a.stage.getScale().x,e=a.image.height*a.stage.getScale().y,f=-1*(a.mySquarePreview.position().left*d/b),g=-1*(a.mySquarePreview.position().top*e/c);a.stage.setX(f),a.stage.setY(g),a.stage.draw(),a.refreshHotspotsInDrag()},refreshPercentSpan:function(b){var c=this,d=b?b/100:c.stage.getScale().x,e=Math.floor(100*d);a("[data-zoompercent]",c.$el).html("1 - "+e)},getLimits:function(){var a=this,b={x:0,y:0,max:"x"},c=a.$el.width(),d=a.$el.height();return b.max=a.zoomImage.getWidth()>a.zoomImage.getHeight()?"x":"y",b.x=c,b.y=d,b.min="x"===b.max?100*b.x/a.zoomImage.getWidth():100*b.y/a.zoomImage.getHeight(),b},removeAllLocalIntervals:function(){self=this,clearInterval(self.intervalID),clearInterval(self.intervalDrag)},scaleZoomIn:function(){var a=this,b=a.stage.getScale().x,c=a.options.zoomRange/1e3,d=b+c,e=b+c;b>=d||b>=1?(a.removeAllLocalIntervals(),a.stage.setScale(1),a.stage.draw(),a.refreshPreviewPanel()):(a.stage.setScale(e),a.stage.draw(),a.refreshPreviewPanel()),(a.stage.getHeight()>a.zoomImage.getHeight()*b||a.stage.getWidth()>a.zoomImage.getWidth()*b)&&(a.removeAllLocalIntervals(),a.stage.setScale(1),a.stage.draw(),a.refreshPreviewPanel())},scaleZoomOut:function(){var a=this,b=!0,c=a.stage.getScale().x,d=a.options.zoomRange/1e3,e=a.getLimits(),f=e.min,g=c-d,h=f/100;b=h>=c?!1:!0,b?(a.stage.setScale(g),a.stage.draw(),a.refreshPreviewPanel()):(a.removeAllLocalIntervals(),a.stage.setScale(f/100),a.stage.draw(),a.refreshPreviewPanel())},scaleStage:function(a,b){var c=this,d=b.value/100,e=c.stage.getX(),f=c.stage.getY();c.stage.setScale(d),c.stage.setX(e*d),c.stage.setY(f*d),c.stage.draw(),c.refreshPreviewPanel()},createHotSpots:function(){var a=this;_.isEmpty(a.options.hotspots)||a.addHotspotsToStage()},addHotspotsToStage:function(){var b=this;b.stage.getScale().x,b.hotspotsContainer=a('<div class="zoom-hotspots-container" style="position:absolute;"></div>');for(var c="",d=0;d<b.options.hotspots.length;d++){var e=b.options.hotspots[d],f=e.image;c=f?b.hotspotImage({properties:b.options.hotspots[d],number:d}):b.hotspotDiv({properties:b.options.hotspots[d],number:d}),b.hotspotsContainer.append(c),e.onComplete&&e.onComplete({},c),b.hotSpots.push(c)}a("#"+b.idPanel,b.$el).prepend(b.hotspotsContainer),b.hotspotsList=a(".zoom-hotspot",b.hotspotsContainer),b.hotspotsContainer.on("click",".zoom-hotspot",function(c){var d=a(this).data("number"),e=a(this);b.options.hotspots[d].onClick&&b.options.hotspots[d].onClick(c,e)}),b.hotspotsContainer.on("mouseenter",".zoom-hotspot",function(c){var d=a(this).data("number"),e=a(this);b.options.hotspots[d].onMouseOver&&b.options.hotspots[d].onMouseOver(c,e)}),b.hotspotsContainer.on("mouseout",".zoom-hotspot",function(c){var d=a(this).data("number"),e=a(this);b.options.hotspots[d].onMouseOut&&b.options.hotspots[d].onMouseOut(c,e)})},hotspotImage:function(b){var c=this,d=new Image,e=a('<span class="zoom-hotspot  zoom-hotspot-image"></span>');return d.onload=function(){e.data("real-width",d.width),e.data("real-height",d.height),e.data("real-left",b.properties.x),e.data("real-top",b.properties.y),e.data("number",b.number),b.properties.w=d.width,b.properties.h=d.height,c.setHotspotProperties(b,e);var f=a('<img src="'+d.src+'"/>');e.append(f)},d.src=b.properties.image,e},hotspotDiv:function(b){var c=this,d=a('<div class="zoom-hotspot zoom-hotspot-div"></div>');return d.data("real-width",b.properties.w),d.data("real-height",b.properties.h),d.data("real-left",b.properties.x),d.data("real-top",b.properties.y),b.properties.radius&&d.css("border-radius",b.properties.radius),b.properties.css&&d.addClass(b.properties.css),d.data("number",b.number),b.properties.id&&d.attr("id",b.properties.id),b.properties.content&&d.append(b.properties.content),c.setHotspotProperties(b,d),d},setHotspotProperties:function(a,b){var c=this,d=c.stage.getScale().x,e=a.properties.w*d,f=a.properties.h*d,g=a.properties.x*d,h=a.properties.y*d;b.css("width",e+"px"),b.css("height",f+"px"),b.css("left",g+"px"),b.css("top",h+"px")},refreshHotspotsScale:function(){for(var b=this,c=b.hotspotsList,d=b.stage.getScale().x,e=0;e<c.length;e++){var f=a(c[e]),g=f.data("real-width")*d,h=f.data("real-height")*d,i=f.data("real-left")*d,j=f.data("real-top")*d;f.width(g),f.height(h),f.css("left",i),f.css("top",j)}},refreshPreviewPanelInDrag:function(){var a=this;a.$kinetic.width(),a.$kinetic.height();var b=a.$panelPreview.width(),c=a.$panelPreview.height(),d=b/(a.image.width*a.stage.getScale().x),e=c/(a.image.height*a.stage.getScale().y),f=-1*a.stage.getX()*d,g=-1*a.stage.getY()*e,h=f,i=g;a.mySquarePreview&&a.mySquarePreview.css("left",h).css("top",i)},refreshHotspotsInDrag:function(){var a=this;a.hotspotsList;var b=a.stage.getX(),c=a.stage.getY();a.stage.getScale().x,a.hotspotsContainer.css("left",b).css("top",c)},refreshPanel:function(b){var c,d,e,f=this;c=b&&b.width?b.width:f.$el.width(),d=b&&b.height?b.height:f.$el.height(),f.stage.setWidth(c),f.stage.setHeight(d),e=f.stage.getScale().x;var g=f.getLimits(),h=a.extend(f.sliderOptions,{min:g.min});f.$slider.hasClass("ui-slider")&&f.$slider.slider("destroy"),f.$slider.slider(h),a(".ui-slider-handle",f.$slider).unbind("keydown"),a(".ui-slider-handle",f.$el).append('<div class="zoom-value-tooltip">100</div>'),f.stage.getHeight()>f.zoomImage.getHeight()*e&&f.stage.getWidth()>f.zoomImage.getWidth()*e?(f.$panelPreview.hide(),a("[data-zoomiconpanepanel]").hide(),a(".zoom-control",f.$el).hide(),f.stage.setDraggable(!1),f.$kinetic.addClass("no-drag")):(f.$panelPreview.show(),a("[data-zoomiconpanepanel]").show(),a(".zoom-control",f.$el).show(),f.stage.setDraggable(!0),f.$kinetic.removeClass("no-drag")),f.refreshPreviewPanel()},moveTo:function(a){var b=this,c=b.stage.getScale().x,d=b.stage.getX(),e=b.stage.getY(),f=b.stage.getWidth()-b.zoomImage.getWidth(),g=b.stage.getHeight()-b.zoomImage.getHeight();a.fit?b.stage.getHeight()>b.zoomImage.getHeight()*c&&b.stage.getWidth()>b.zoomImage.getWidth()*c?b.stage.setPosition(0,0):(b.stage.setX(d),b.stage.setY(e)):b.stage.getHeight()>b.zoomImage.getHeight()*c&&b.stage.getWidth()>b.zoomImage.getWidth()*c?b.stage.setPosition(0,0):(b.stage.getScale().x<1&&(f=b.stage.getWidth()-b.zoomImage.getWidth()*c,g=b.stage.getHeight()-b.zoomImage.getHeight()*c),a.x&&(a.x>=0?a.x=0:a.x<f&&(a.x=f),a.y>=0?a.y=0:a.y<g&&(a.y=g)),a.x>0&&(a.x=0),a.y>0&&(a.y=0),b.stage.setPosition(a.x,a.y)),b.stage.draw(),b.refreshHotspotsInDrag(),b.refreshPreviewPanelInDrag()},showMessage:function(b,c){var d=this;a("#zoom-message").remove();var e=a('<div class="zoom-center-message" id="zoom-message">'+b+"</div>");d.$el.append(e),e.hide(),setTimeout(function(){e.fadeIn(100,function(){$this=a(this),setTimeout(function(){c&&d.removeMessage()},1500)})},500)},removeMessage:function(){var b=a("#zoom-message");b.fadeOut(function(){b.remove()})}},a.fn.zoom=function(b,c){var d={image:"img/defult.jpg",zoomRange:50,hotspots:[],dragMessage:"Drag Image (Image Pane)",processMessage:"Process Image....",previewWidth:120,previewHeight:120,hotspotsCSS:"",draggable:!0,controls:!0,zoomImageOptions:!1,moveIncrement:20,isIE:!1};return a.extend(d,b),"string"!=typeof b?this.each(function(){$zoom.init(this,d)}):("resize"===b?$zoom.refreshPanel(c):$zoom[b](c),void 0)}}(jQuery);